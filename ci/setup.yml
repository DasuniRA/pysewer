.setup_template: &setup_template
  stage: setup
  script:
    - apt-get update && apt-get install -y wget
    - wget -q https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh
    - bash Miniforge3-Linux-x86_64.sh -b -p $HOME/miniforge3
    - export PATH="$HOME/miniforge3/bin:$PATH"
    - conda config --set always_yes yes --set changeps1 no
    - conda create -n pysewer python=${PYTHON_VERSION}
    - source activate pysewer
    - conda install -c conda-forge gdal fiona shapely
    - conda install -c conda-forge make
    - pip install --upgrade pip
    - pip install sphinx sphinx-autobuild sphinx_rtd_theme pydata-sphinx-theme sphinx-codeautolink sphinx_design sphinx-favicon sphinxcontrib-applehelp sphinxcontrib-devhelp sphinxcontrib-mermaid ablog myst-parser matplotlib sphinx-copybutton
    - pip install .

setup:ubuntu:
  <<: *setup_template
  image: ubuntu:latest
  parallel:
    matrix:
      - PYTHON_VERSION: ['3.9', '3.10', '3.11']

setup:windows:
  <<: *setup_template
  tags:
    - windows
  parallel:
    matrix:
      - PYTHON_VERSION: ['3.9', '3.10', '3.11']
  before_script:
    - choco install wget
    - choco install miniconda3
    - $env:PATH += ";C:\tools\miniconda3\Scripts"
  script:
    - conda config --set always_yes yes --set changeps1 no
    - conda create -n pysewer python=${PYTHON_VERSION}
    - conda activate pysewer
    - conda install -c conda-forge gdal fiona shapely
    - conda install -c conda-forge make
    - pip install --upgrade pip
    - pip install sphinx sphinx-autobuild sphinx_rtd_theme pydata-sphinx-theme sphinx-codeautolink sphinx_design sphinx-favicon sphinxcontrib-applehelp sphinxcontrib-devhelp sphinxcontrib-mermaid ablog myst-parser matplotlib sphinx-copybutton
    - pip install .

setup:macos:
  <<: *setup_template
  tags:
    - macos
  parallel:
    matrix:
      - PYTHON_VERSION: ['3.9', '3.10', '3.11']
  before_script:
    - brew install wget
    - wget -q https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-x86_64.sh
    - bash Miniforge3-MacOSX-x86_64.sh -b -p $HOME/miniforge3
    - export PATH="$HOME/miniforge3/bin:$PATH"