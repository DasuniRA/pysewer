build_docs:
  stage: build
  image: ubuntu:latest
  needs:
    - job: test:ubuntu
      parallel:
        matrix:
          - PYTHON_VERSION: "3.10"
  variables:
    PYTHON_VERSION: "3.10"
  script:
    - apt-get update && apt-get install -y wget
    - wget -q https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh
    - bash Miniforge3-Linux-x86_64.sh -b -p $HOME/miniforge3
    - export PATH="$HOME/miniforge3/bin:$PATH"
    - conda config --set always_yes yes --set changeps1 no
    - conda create -n pysewer python=${PYTHON_VERSION}
    - source activate pysewer
    - conda install -c conda-forge gdal fiona shapely
    - conda install -c conda-forge make
    - pip install --upgrade pip
    - pip install sphinx sphinx-autobuild sphinx_rtd_theme pydata-sphinx-theme sphinx-codeautolink sphinx_design sphinx-favicon sphinxcontrib-applehelp sphinxcontrib-devhelp sphinxcontrib-mermaid ablog myst-parser matplotlib sphinx-copybutton
    - pip install .
    - cd docs
    - make clean html
    - make html
    - cd ..
    - mv docs/build/html public
  artifacts:
    paths:
      - public